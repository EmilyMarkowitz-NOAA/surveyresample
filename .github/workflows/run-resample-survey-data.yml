name: run-resample-survey-data
on:
  workflow_dispatch:
  push:

jobs:
  run-resample-survey-data:
    runs-on: windows-latest
    env:
      R_REMOTES_NO_ERRORS_FROM_WARNINGS: true
      RSPM: "https://packagemanager.rstudio.com/cran/__linux__/focal/latest"

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      
      - name: Setup R
        uses: r-lib/actions/setup-r@v2

      # - name: ubuntu packages
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install build-essential libcurl4-gnutls-dev libxml2-dev libssl-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev -y
      
      - name: install R packages
        run: |
          Rscript -e 'install.packages(c("sampling","sdmTMB", "doParallel", "devtools", "ggplot2", "dplyr", "tidyr", "readr", "purrr", "tibble", "forcats"))'

      - name: Setup file structure
        run: |
          mkdir Figures
          mkdir Results
          cd Results
          mkdir Arrowtooth_flounder
          mkdir Bocaccio
          mkdir Canary_rockfish
          mkdir Darkblotched_rockfish
          mkdir Dover_sole
          mkdir Lingcod_north
          mkdir Lingcod_south
          mkdir Longnose_skate
          mkdir Pacific_ocean_perch
          mkdir Pacific_spiny_dogfish
          mkdir Petrale_sole
          mkdir Rex_sole
          mkdir Sablefish
          mkdir Shortspine_thornyhead
          mkdir Widow_rockfish
          mkdir Yellowtail_rockfish
          
           
      - name: Run script
        run: |
          Rscript resample_survey_data_NWFSC_BT_main_code_file.R

      - name: Zip files
        run: |
           zip -r results.zip Results
      
      - name: Upload artifact of Results
        uses: actions/upload-artifact@main
        with:
          name: 'results.zip'
          path: results.zip
